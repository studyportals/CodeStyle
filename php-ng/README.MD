# Next-gen PHP Coding Standard (RFC-5)

For use with newly created PHP 7.2+ projects &ndash; for a good example see
[**PageModels**](https://github.com/studyportals/PageModels).

## The Standard

Uses **PHP Code Sniffer** (`phpcs`) to enforce the
**[PSR-12 extended coding style](https://www.php-fig.org/psr/psr-12/)**.

Apart from PSR-12, Code Sniffer also enforces
**[strict type-checks for scalar types](https://wiki.php.net/rfc/scalar_type_hints_v5)**.
You need to manually enable these checks for _each_ PHP file as follows:

```php
<?php declare(strict_types=1);

// Code goes here...
```

It enables the full
[**PHP Mess Detector** (`phpmd`) rule-set](https://phpmd.org/rules/index.html)
with the exception of the
[controversial-rules](https://phpmd.org/rules/controversial.html) and the
[naming-rules](https://phpmd.org/rules/naming.html) (which are covered by PSR-12
instead).

It uses the **[PHP Static Analysis Tool](https://github.com/phpstan/phpstan)**
(`phpstan`) to enforce the maximum type-strictness (and catch a large variety of
additional errors in the process).

âš  Finally, it provides a skeleton for setting up PHPunit (including code
coverage analysis) and Code Climate. And uses the composer git-hooks package to
run all of the above checks pre-push.

## Getting Started

Copy all files from the `php-ng` folder into the root of your repository (minus
this `README.md` file).

In `travis.yml` update `CC_TEST_REPORTER_ID` for Code Climate coverage
integration

Add `clover.xml` to your `.gitignore` (file is generated by PHPUnit when
generating code-coverage, don't want it checked into GitHub).

Requires XDdebug to be installed.

Install the following composer dev-dependencies

```json
"phpunit/phpunit": "^7.5",
"mockery/mockery": "^1.2",
"phpstan/phpstan": "^0.11.16",
"phpstan/phpstan-mockery": "^0.11.3",
"phpstan/extension-installer": "^1.0",
"brainmaestro/composer-git-hooks": "^2.8",
"phpstan/phpstan-phpunit": "^0.11.2",
"squizlabs/php_codesniffer": "^3.5",
"slevomat/coding-standard": "^5.0",
"phpmd/phpmd": "^2.7"
```

Add the following scripts your `composer.json`:

```json
"test": "phpunit",
"coverage": "phpunit --coverage-clover clover.xml",
"phpstan": "phpstan analyse --level=max src/ tests/",
"phpcs": "phpcs --colors -p -n src/ tests/",
"phpcbf": "phpcbf --colors -p -n src/ tests/",
"phpmd": "phpmd src/ text phpmd.xml",
"phpmd-tests": "phpmd tests/ text phpmd.tests.xml",
"post-install-cmd": "cghooks add --ignore-lock",
"post-update-cmd": "cghooks update",
```

https://github.com/BrainMaestro/composer-git-hooks

Setup cghooks:

Add the following to your `composer.json`

```json
"extra": {
  "hooks": {
    "pre-push": [
      "composer run test",
      "composer run phpstan",
      "composer run phpcs",
      "composer run phpmd",
      "composer run phpmd-tests"
    ]
  }
},

```

To set it up for your repository, run once:

`vendor/bin/cghooks add --ignore-lock`

If you make changes to the hooks, run:

`vendor/bin/cghooks update`

phpunit, all files should end in \*Test.php

```





```

Folder-structure

- /src/...
- /tests/...

Due to limitations with phpmd, there are two separate phpmd configurations (one
for src, one for tests).
